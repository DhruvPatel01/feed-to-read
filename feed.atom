<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>urn:2024-01-07T00:59:30.837Z</id>
    <title>osmos::feed</title>
    <updated>2024-01-07T00:59:30.837Z</updated>
    <generator>osmosfeed 1.15.1</generator>
    <link rel="alternate" href="index.html"/>
    <entry>
        <title type="html"><![CDATA[Of Rats and Ratchets]]></title>
        <id>https://matklad.github.io/2024/01/03/of-rats-and-ratchets.html</id>
        <link href="https://matklad.github.io/2024/01/03/of-rats-and-ratchets.html"/>
        <updated>2024-01-03T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[This is going to be related to software engineering, pinky promise!]]></summary>
        <author>
            <name>matklad</name>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Git Things]]></title>
        <id>https://matklad.github.io/2023/12/31/git-things.html</id>
        <link href="https://matklad.github.io/2023/12/31/git-things.html"/>
        <updated>2023-12-31T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[A grab bag of less frequently talked about git adjacent points.]]></summary>
        <author>
            <name>matklad</name>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[O(1) Build File]]></title>
        <id>https://matklad.github.io/2023/12/31/O(1)-build-file.html</id>
        <link href="https://matklad.github.io/2023/12/31/O(1)-build-file.html"/>
        <updated>2023-12-31T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Rule of thumb: the size of build or CI configuration should be mostly independent of the project size.
In other words, adding, say, a new test should not require adding a new line to the build file to build the test, and a new line to .yml to run it on CI.]]></summary>
        <author>
            <name>matklad</name>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Generating Standalone Haddock Docs for a Multi-package Haskell Project]]></title>
        <id>https://notes.abhinavsarkar.net/2023/standalone-haddock</id>
        <link href="https://notes.abhinavsarkar.net/2023/standalone-haddock"/>
        <updated>2023-12-31T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>So here’s a thing I recently wanted to do. I am working on a personal Haskell project, and as the
project grew big, I split it up into multiple packages. Something like <code class="language-plaintext highlighter-rouge">project-core</code>, <code class="language-plaintext highlighter-rouge">project-backend</code>,
<code class="language-plaintext highlighter-rouge">project-frontend</code> and such. After writing some thousands of lines of code, I decided to put the
project documentation online. Now, this is not the kind of project that I’d publish as a bunch of
libraries on <a href="https://hackage.haskell.org/">Hackage</a>. Nevertheless, I wanted to publish the API docs and hyperlinked source code
online as a self-contained website. Well, turns out, this is a really hard to do with Haskell projects.</p>

<p>Haskell has <a href="http://www.haskell.org/haddock/">Haddock</a>, its documentation generation tool. It generates
the API docs and sources fine, but not for a self-contained website. You can run <code class="language-plaintext highlighter-rouge">cabal haddock-project</code> in the <code class="language-plaintext highlighter-rouge">--local</code> mode,
in which all the generated docs will link to other packages’ local docs only. Or you can run it in
the <code class="language-plaintext highlighter-rouge">--hackage</code> mode, in which the
docs will link to other packages’ docs on Hackage. In either case, all the hyperlinked source code
link only to other packages’ local source code. I didn’t want this.</p>

<p>What I wanted was to generate API docs and source code that linked to local ones only for the
packages in my project, and to the Hackage ones for all my project’s dependency libraries. This just doesn’t
seem possible with Haddock.</p>

<p>So I did what I had to. I summoned my old self from when I used to work as a Perl<sup id="fnref:fn3" role="doc-noteref"><a href="#fn:fn3" class="footnote" rel="footnote">1</a></sup> programmer
(my first job decades ago!), and I wrote
some regexes<sup id="fnref:fn1" role="doc-noteref"><a href="#fn:fn1" class="footnote" rel="footnote">2</a></sup> and a Bash script<sup id="fnref:fn2" role="doc-noteref"><a href="#fn:fn2" class="footnote" rel="footnote">3</a></sup>. It took some experimentation, but I finally got it working. Here it is
in its full glory:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/env bash</span>
<span class="nb">set</span> <span class="nt">-euo</span> pipefail

<span class="k">if</span> <span class="o">[</span> <span class="nv">$# </span><span class="nt">-ne</span> 2 <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> &lt;title&gt; &lt;output&gt;"</span>
    <span class="nb">exit </span>1
<span class="k">fi

</span><span class="nv">TITLE</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">OUTPUT</span><span class="o">=</span><span class="nv">$2</span>

<span class="nv">OS</span><span class="o">=</span><span class="si">$(</span><span class="nb">uname</span> <span class="nt">-s</span><span class="si">)</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$OS</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"Darwin"</span> <span class="o">]</span>
<span class="k">then
    </span><span class="nv">OS</span><span class="o">=</span><span class="s2">"osx"</span>
<span class="k">elif</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$OS</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"Linux"</span> <span class="o">]</span>
<span class="k">then
    </span><span class="nv">OS</span><span class="o">=</span><span class="s2">"linux"</span>
<span class="k">else
    </span><span class="nb">printf</span> <span class="s2">"OS not supported: %s</span><span class="se">\n</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$OS</span><span class="s2">"</span> <span class="o">&gt;</span>&amp;2
    <span class="nb">exit </span>1
<span class="k">fi

</span><span class="nv">ARCH</span><span class="o">=</span><span class="si">$(</span><span class="nb">uname</span> <span class="nt">-m</span><span class="si">)</span>
<span class="nv">GHC_VERSION</span><span class="o">=</span><span class="si">$(</span>ghc <span class="nt">--version</span> | <span class="nb">awk</span> <span class="s1">'{print $8}'</span><span class="si">)</span>
<span class="nv">PKG_NAME</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat</span> ./<span class="k">*</span>.cabal | <span class="nb">grep </span>name | <span class="nb">head</span> <span class="nt">-1</span> | <span class="nb">awk</span> <span class="s1">'{print $2}'</span><span class="si">)</span>
<span class="nv">PKG_VERSION</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat</span> ./<span class="k">*</span>.cabal | <span class="nb">grep </span>version | <span class="nb">grep</span> <span class="nt">-v</span> cabal | <span class="nb">awk</span> <span class="s1">'{print $2}'</span> | <span class="nb">head</span> <span class="nt">-1</span><span class="si">)</span>
<span class="nv">BUILD_PATH</span><span class="o">=</span><span class="s2">"dist-newstyle/build/</span><span class="k">${</span><span class="nv">ARCH</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">OS</span><span class="k">}</span><span class="s2">/ghc-</span><span class="k">${</span><span class="nv">GHC_VERSION</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">PKG_NAME</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">PKG_VERSION</span><span class="k">}</span><span class="s2">"</span>
<span class="nv">DOC_PATH</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">BUILD_PATH</span><span class="k">}</span><span class="s2">/l/*/doc/html/</span><span class="k">${</span><span class="nv">PKG_NAME</span><span class="k">}</span><span class="s2">"</span>

<span class="nv">temp_files</span><span class="o">=()</span>

cleanup<span class="o">()</span> <span class="o">{</span>
  <span class="k">for </span>file <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">temp_files</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
        </span><span class="nb">rm</span> <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span>
  <span class="k">done</span>
<span class="o">}</span>
<span class="nb">trap </span>cleanup EXIT INT TERM

bold_print<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\0</span><span class="s2">33[1m</span><span class="nv">$1</span><span class="se">\0</span><span class="s2">33[0m"</span>
<span class="o">}</span>

<span class="c"># build project</span>
bold_print <span class="s2">"Building project"</span>
cabal build <span class="nt">--enable-documentation</span>

<span class="c"># generate docs</span>
bold_print <span class="s2">"Generating docs"</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s2">"</span><span class="k">${</span><span class="nv">OUTPUT</span><span class="k">}</span><span class="s2">"</span>
cabal haddock <span class="nt">--haddock-html</span> <span class="se">\</span>
    <span class="nt">--haddock-quickjump</span> <span class="se">\</span>
    <span class="nt">--haddock-hyperlink-source</span> <span class="se">\</span>
    <span class="nt">--haddock-option</span><span class="o">=</span><span class="s2">"--use-index=../doc-index.html"</span> <span class="se">\</span>
    <span class="nt">--haddock-option</span><span class="o">=</span><span class="s2">"--use-contents=../index.html"</span> <span class="se">\</span>
    <span class="nt">--haddock-option</span><span class="o">=</span><span class="s2">"--base-url=.."</span> <span class="se">\</span>
    all
<span class="nb">cp</span> <span class="nt">-f</span> <span class="nt">-r</span> <span class="k">${</span><span class="nv">DOC_PATH</span><span class="k">}</span>/ <span class="s2">"</span><span class="k">${</span><span class="nv">OUTPUT</span><span class="k">}</span><span class="s2">"</span>

<span class="c"># generate index</span>
bold_print <span class="s2">"Generating index"</span>

<span class="nv">CMD_FILE1</span><span class="o">=</span><span class="si">$(</span><span class="nb">mktemp</span><span class="si">)</span>
temp_files+<span class="o">=(</span><span class="s2">"</span><span class="nv">$CMD_FILE1</span><span class="s2">"</span><span class="o">)</span>

<span class="nb">echo</span> <span class="s2">"set -euo pipefail"</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="k">${</span><span class="nv">CMD_FILE1</span><span class="k">}</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"haddock -t </span><span class="se">\"</span><span class="k">${</span><span class="nv">TITLE</span><span class="k">}</span><span class="se">\"</span><span class="s2"> -o </span><span class="se">\"</span><span class="k">${</span><span class="nv">OUTPUT</span><span class="k">}</span><span class="se">\"</span><span class="s2"> --quickjump --gen-index --gen-contents "</span> <span class="o">&gt;&gt;</span> <span class="s2">"</span><span class="k">${</span><span class="nv">CMD_FILE1</span><span class="k">}</span><span class="s2">"</span>
find <span class="k">${</span><span class="nv">DOC_PATH</span><span class="k">}</span>/<span class="k">${</span><span class="nv">PKG_NAME</span><span class="k">}</span>.haddock <span class="nt">-print0</span> | xargs <span class="nt">-0</span> <span class="nt">-I</span> <span class="o">{}</span> <span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"--read-interface=</span><span class="k">${</span><span class="nv">PKG_NAME</span><span class="k">}</span><span class="s2">,{} "</span> <span class="o">&gt;&gt;</span> <span class="s2">"</span><span class="k">${</span><span class="nv">CMD_FILE1</span><span class="k">}</span><span class="s2">"</span>
bash <span class="s2">"</span><span class="k">${</span><span class="nv">CMD_FILE1</span><span class="k">}</span><span class="s2">"</span>

<span class="c"># fix links in hyperlinked source and docs</span>
<span class="nv">GEN_SRC_PATH</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">OUTPUT</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">PKG_NAME</span><span class="k">}</span><span class="s2">/src/*.html"</span>
<span class="nv">GEN_DOC_PATH</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">OUTPUT</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">PKG_NAME</span><span class="k">}</span><span class="s2">/*.html"</span>

bold_print <span class="s2">"Fixing links to project subpackages"</span>
<span class="c"># fix links to source files for project subpackages</span>
perl <span class="nt">-i</span> <span class="nt">-pe</span> <span class="s2">"s|file:[^</span><span class="se">\"</span><span class="s2">]*?/</span><span class="k">${</span><span class="nv">BUILD_PATH</span><span class="k">}</span><span class="s2">/l/.*?/doc/html/</span><span class="k">${</span><span class="nv">PKG_NAME</span><span class="k">}</span><span class="s2">/src/||g"</span> <span class="k">${</span><span class="nv">GEN_SRC_PATH</span><span class="k">}</span>
<span class="c"># fix links to doc files for project subpackages</span>
perl <span class="nt">-i</span> <span class="nt">-pe</span> <span class="s2">"s|href=</span><span class="se">\"</span><span class="s2">../</span><span class="k">${</span><span class="nv">PKG_NAME</span><span class="k">}</span><span class="s2">/|href=</span><span class="se">\"</span><span class="s2">|g"</span> <span class="k">${</span><span class="nv">GEN_DOC_PATH</span><span class="k">}</span>

bold_print <span class="s2">"Fixing links to project dependencies"</span>
<span class="c"># fix links to doc files for project dependency libraries</span>
perl <span class="nt">-i</span> <span class="nt">-pe</span> <span class="s2">"s|href=</span><span class="se">\"</span><span class="s2">../([^</span><span class="se">\"</span><span class="s2">]+)/([^</span><span class="se">\"</span><span class="s2">]+)|href=</span><span class="se">\"</span><span class="s2">https://hackage.haskell.org/package/</span><span class="se">\$</span><span class="s2">1/docs/</span><span class="se">\$</span><span class="s2">2|g"</span> <span class="k">${</span><span class="nv">GEN_DOC_PATH</span><span class="k">}</span>

bold_print <span class="s2">"Fixing links to libraries in Nix store"</span>
<span class="c"># fix links to source files for GHC libraries stored in the Nix store</span>
perl <span class="nt">-i</span> <span class="nt">-pe</span> <span class="s2">"s|file:///nix/store/[</span><span class="se">\d\w</span><span class="s2">]*-ghc-</span><span class="k">${</span><span class="nv">GHC_VERSION</span><span class="k">}</span><span class="s2">-doc/share/doc/ghc/html/libraries/([^</span><span class="se">\"</span><span class="s2">]*)/src/([^</span><span class="se">\"</span><span class="s2">]*)|https://hackage.haskell.org/package/</span><span class="se">\$</span><span class="s2">1/docs/src/</span><span class="se">\$</span><span class="s2">2|g"</span> <span class="k">${</span><span class="nv">GEN_SRC_PATH</span><span class="k">}</span>
<span class="c"># fix links to doc files for GHC libraries stored in the Nix store</span>
perl <span class="nt">-i</span> <span class="nt">-pe</span> <span class="s2">"s|file:///nix/store/[</span><span class="se">\d\w</span><span class="s2">]*-ghc-</span><span class="k">${</span><span class="nv">GHC_VERSION</span><span class="k">}</span><span class="s2">-doc/share/doc/ghc/html/libraries/([^</span><span class="se">\"</span><span class="s2">]*)/src|https://hackage.haskell.org/package/</span><span class="se">\$</span><span class="s2">1/docs/src/|g"</span> <span class="k">${</span><span class="nv">GEN_DOC_PATH</span><span class="k">}</span>

<span class="c"># fix links to source files for Hackage libraries stored in the Nix store</span>
perl <span class="nt">-i</span> <span class="nt">-pe</span> <span class="s2">"s|file:///nix/store/[^</span><span class="se">\"</span><span class="s2">]+-doc/share/doc/([^</span><span class="se">\"</span><span class="s2">]+)/html/src/([^</span><span class="se">\"</span><span class="s2">]+)|https://hackage.haskell.org/package/</span><span class="se">\$</span><span class="s2">1/docs/src/</span><span class="se">\$</span><span class="s2">2|g"</span> <span class="k">${</span><span class="nv">GEN_SRC_PATH</span><span class="k">}</span>
<span class="c"># fix links to doc files for Hackage libraries stored in the Nix store</span>
perl <span class="nt">-i</span> <span class="nt">-pe</span> <span class="s2">"s|file:///nix/store/[^</span><span class="se">\"</span><span class="s2">]+-doc/share/doc/([^</span><span class="se">\"</span><span class="s2">]+)/html/src|https://hackage.haskell.org/package/</span><span class="se">\$</span><span class="s2">1/docs/src|g"</span> <span class="k">${</span><span class="nv">GEN_DOC_PATH</span><span class="k">}</span>

<span class="c"># generate Cabal package short ID to package name mapping</span>
bold_print <span class="s2">"Generating Cabal package short ID to package name mapping"</span>
<span class="nv">SHORT_IDS_FILE</span><span class="o">=</span><span class="si">$(</span><span class="nb">mktemp</span><span class="si">)</span>
temp_files+<span class="o">=(</span><span class="s2">"</span><span class="nv">$SHORT_IDS_FILE</span><span class="s2">"</span><span class="o">)</span>

<span class="nb">grep</span> <span class="nt">-h</span> <span class="nt">-o</span> <span class="nt">-P</span> <span class="s2">"href=</span><span class="se">\"</span><span class="s2">file://[^</span><span class="se">\"</span><span class="s2">]+/</span><span class="se">\.</span><span class="s2">cabal/store/ghc-</span><span class="k">${</span><span class="nv">GHC_VERSION</span><span class="k">}</span><span class="s2">/.+?/"</span> <span class="k">${</span><span class="nv">GEN_SRC_PATH</span><span class="k">}</span> <span class="k">${</span><span class="nv">GEN_DOC_PATH</span><span class="k">}</span> | <span class="se">\</span>
  <span class="nb">sort</span> <span class="nt">-u</span> | <span class="nb">grep</span> <span class="nt">-h</span> <span class="nt">-o</span> <span class="nt">-P</span> <span class="s2">"</span><span class="se">\.</span><span class="s2">cabal/store/ghc-</span><span class="k">${</span><span class="nv">GHC_VERSION</span><span class="k">}</span><span class="s2">/.+?/"</span> | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s1">'/'</span> <span class="nt">-f</span> 4 <span class="o">&gt;</span> <span class="s2">"</span><span class="k">${</span><span class="nv">SHORT_IDS_FILE</span><span class="k">}</span><span class="s2">"</span>

<span class="nv">PKG_NAMES_FILE</span><span class="o">=</span><span class="si">$(</span><span class="nb">mktemp</span><span class="si">)</span>
temp_files+<span class="o">=(</span><span class="s2">"</span><span class="nv">$PKG_NAMES_FILE</span><span class="s2">"</span><span class="o">)</span>

<span class="nb">grep</span> <span class="nt">-h</span> <span class="nt">-o</span> <span class="nt">-P</span> <span class="s2">"href=</span><span class="se">\"</span><span class="s2">file://[^</span><span class="se">\"</span><span class="s2">]+/</span><span class="se">\.</span><span class="s2">cabal/store/ghc-</span><span class="k">${</span><span class="nv">GHC_VERSION</span><span class="k">}</span><span class="s2">/.+?/"</span> <span class="k">${</span><span class="nv">GEN_SRC_PATH</span><span class="k">}</span> <span class="k">${</span><span class="nv">GEN_DOC_PATH</span><span class="k">}</span> | <span class="nb">sort</span> <span class="nt">-u</span> | <span class="se">\</span>
  <span class="nb">cut</span> <span class="nt">-c</span> 14- | xargs <span class="nt">-I</span> <span class="o">{}</span> <span class="nb">cat</span> <span class="o">{}</span>cabal-hash.txt | <span class="nb">grep</span> <span class="s2">"pkgid:"</span> | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s1">' '</span> <span class="nt">-f</span> 2 <span class="o">&gt;</span> <span class="s2">"</span><span class="k">${</span><span class="nv">PKG_NAMES_FILE</span><span class="k">}</span><span class="s2">"</span>

<span class="nv">CMD_FILE2</span><span class="o">=</span><span class="si">$(</span><span class="nb">mktemp</span><span class="si">)</span>
temp_files+<span class="o">=(</span><span class="s2">"</span><span class="nv">$CMD_FILE2</span><span class="s2">"</span><span class="o">)</span>

<span class="nb">echo</span> <span class="s2">"set -euo pipefail"</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="k">${</span><span class="nv">CMD_FILE2</span><span class="k">}</span><span class="s2">"</span>
<span class="nb">paste</span> <span class="nt">-d</span> <span class="s2">" "</span> <span class="s2">"</span><span class="k">${</span><span class="nv">SHORT_IDS_FILE</span><span class="k">}</span><span class="s2">"</span> <span class="s2">"</span><span class="k">${</span><span class="nv">PKG_NAMES_FILE</span><span class="k">}</span><span class="s2">"</span> | <span class="nb">awk</span> <span class="s2">"{print </span><span class="se">\"</span><span class="s2">perl -i -pe </span><span class="se">\\\"</span><span class="s2">s|</span><span class="se">\"\$</span><span class="s2">1</span><span class="se">\"</span><span class="s2">|</span><span class="se">\"\$</span><span class="s2">2</span><span class="se">\"</span><span class="s2">|g</span><span class="se">\\\"</span><span class="s2"> </span><span class="k">${</span><span class="nv">GEN_SRC_PATH</span><span class="k">}</span><span class="s2"> </span><span class="k">${</span><span class="nv">GEN_DOC_PATH</span><span class="k">}</span><span class="se">\"</span><span class="s2">}"</span> <span class="o">&gt;&gt;</span> <span class="s2">"</span><span class="k">${</span><span class="nv">CMD_FILE2</span><span class="k">}</span><span class="s2">"</span>
bash <span class="s2">"</span><span class="k">${</span><span class="nv">CMD_FILE2</span><span class="k">}</span><span class="s2">"</span>

<span class="c"># fix links to doc and source files of libraries stored in the Cabal store</span>
bold_print <span class="s2">"Fixing links to libraries in Cabal store"</span>
perl <span class="nt">-i</span> <span class="nt">-pe</span> <span class="s2">"s|href=</span><span class="se">\"</span><span class="s2">file://[^</span><span class="se">\"</span><span class="s2">]+/</span><span class="se">\.</span><span class="s2">cabal/store/ghc-</span><span class="k">${</span><span class="nv">GHC_VERSION</span><span class="k">}</span><span class="s2">/(.+?)/share/doc/html/([^</span><span class="se">\"</span><span class="s2">]+)|href=</span><span class="se">\"</span><span class="s2">https://hackage.haskell.org/package/</span><span class="se">\$</span><span class="s2">1/docs/src/</span><span class="se">\$</span><span class="s2">2|g"</span> <span class="k">${</span><span class="nv">GEN_DOC_PATH</span><span class="k">}</span>
perl <span class="nt">-i</span> <span class="nt">-pe</span> <span class="s2">"s|href=</span><span class="se">\"</span><span class="s2">file://[^</span><span class="se">\"</span><span class="s2">]+/</span><span class="se">\.</span><span class="s2">cabal/store/ghc-</span><span class="k">${</span><span class="nv">GHC_VERSION</span><span class="k">}</span><span class="s2">/(.+?)/share/doc/html/src|href=</span><span class="se">\"</span><span class="s2">https://hackage.haskell.org/package/</span><span class="se">\$</span><span class="s2">1/docs/src/|g"</span> <span class="k">${</span><span class="nv">GEN_SRC_PATH</span><span class="k">}</span>

<span class="nb">rm</span> <span class="s2">"</span><span class="k">${</span><span class="nv">OUTPUT</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">PKG_NAME</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">PKG_NAME</span><span class="k">}</span><span class="s2">.haddock"</span>
bold_print <span class="s2">"Done"</span>
</code></pre></div></div>

<p>You can invoke this script in your project’s root directory like so:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash standalone-haddock.sh "My wonderful project" docs
</code></pre></div></div>

<p>It will generate correctly linked and self-contained docs in the <code class="language-plaintext highlighter-rouge">docs</code> directory. Now you
can publish this directory on Github pages, or wherever you want.</p>

<p>I hope this script is useful to you. If you know better ways of accomplishing this task, please
let me know.</p>

<p>You can like, share or comment on this post on <a href="https://fantastic.earth/@abnv/111675766745919140" class="mastodon-link">Mastodon</a>.</p>
<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:fn3" role="doc-endnote">
      <p><a href="https://www.xkcd.com/224">Ahmm</a>. <a href="#fnref:fn3" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:fn1" role="doc-endnote">
      <p>Thankfully, generated HTML files are uniform enough for regex substitutions. <a href="#fnref:fn1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:fn2" role="doc-endnote">
      <p><a href="https://www.shellcheck.net/">Shellcheck</a> is an absolute life saver when writing Bash scripts. <a href="#fnref:fn2" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>]]></summary>
        <author>
            <name>Posts on abhinavsarkar.net</name>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Science and Technology links (December 30th 2023)]]></title>
        <id>https://lemire.me/blog/?p=21051</id>
        <link href="https://lemire.me/blog/2023/12/30/science-and-technology-links-december-30th-2023/"/>
        <updated>2023-12-30T20:18:07.000Z</updated>
        <summary type="html"><![CDATA[Parenting does not appear to be able to determine the personality traits of a child. When the last ice age ended, 12,000 years ago, the Sahara was green and full of life. It turned into a desert about 5,500 years ago. Fadnes et al. claim that the UK population could live 10 years older if … Continue reading Science and Technology links (December 30th 2023)]]></summary>
        <author>
            <name>Daniel Lemire</name>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[CI Dream]]></title>
        <id>https://matklad.github.io/2023/12/24/ci-dream.html</id>
        <link href="https://matklad.github.io/2023/12/24/ci-dream.html"/>
        <updated>2023-12-24T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[This is more of an android dream (that one with a unicorn) than a coherent post, but please indulge me.
It's a short one at least!]]></summary>
        <author>
            <name>matklad</name>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Retry Loop]]></title>
        <id>https://matklad.github.io/2023/12/21/retry-loop.html</id>
        <link href="https://matklad.github.io/2023/12/21/retry-loop.html"/>
        <updated>2023-12-21T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[A post about writing a retry loop. Not a smart post about avoiding thundering heards and resonance.
A simpleton kind of post about wrangling ifs and fors together to minimize bugs.]]></summary>
        <author>
            <name>matklad</name>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Versions 2.0.2 and 1.6.18 released]]></title>
        <id>https://nim-lang.org//blog/2023/12/19/versions-1618-202-released.html</id>
        <link href="https://nim-lang.org//blog/2023/12/19/versions-1618-202-released.html"/>
        <updated>2023-12-19T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[The Nim team is happy to announce two releases:
the latest Nim, version 2.0.2
LTS release, version 1.6.18
For the majority of our users, v2.0.2 contains 63 commits and brings bugfixes and improvements to Nim 2.0.0, released four months ago.
NOTE: If your program uses threads (--threads:on became the default in the 2.0.x line) please also use the -d:useMalloc switch.
This problem will be fixed in 2.0.4, sorry for the inconvenience.
For those users who haven’t switched to Nim v2.0 yet, we have released the ninth patch release for Nim 1.6.x.
It is a small release with 13 commits.
Nim Community Survey 2023
Before going into details of the release, we would like to remind you that 2023 Nim Community Survey is still open, and we would appreciate your input if you haven’t done it already.
Install…]]></summary>
        <author>
            <name>Nim Programming Language</name>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[So you want custom allocator support in your C library]]></title>
        <id>https://nullprogram.com/blog/2023/12/17/</id>
        <link href="https://nullprogram.com/blog/2023/12/17/"/>
        <updated>2023-12-17T17:52:26.000Z</updated>
        <summary type="html"><![CDATA[This article was discussed on Hacker News and on reddit.
Users of mature C libraries conventionally get to choose how memory is
allocated — that is, when it cannot be avoided entirely. The C
standard never laid down a convention — perhaps for the better —
so each library re-invents an allocator interface. Not all are created
equal, and most repeat a few fundamental mistakes. Often the interface is
merely a token effort, to check off that it’s “supported” without actual
consideration to its use. This article describes the critical features of
a practical allocator interface, and demonstrates why they’re important.
Before diving into the details, here’s the checklist for library authors:
All allocation functions accept a user-defined context pointer.
The “free” function accepts the original …]]></summary>
        <author>
            <name>null program</name>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Our First Netflix Data Engineering Summit]]></title>
        <id>https://medium.com/p/f326b0589102</id>
        <link href="https://netflixtechblog.com/our-first-netflix-data-engineering-summit-f326b0589102?source=rss----2615bd06b42e---4"/>
        <updated>2023-12-14T16:54:11.000Z</updated>
        <summary type="html"><![CDATA[Holden Karau Elizabeth Stone Pedro Duarte Chris Stephens Pallavi Phadnis Lee Woodridge Mark Cho Guil Pires Sujay Jain Tristan Reid…]]></summary>
        <author>
            <name>Netflix Technology Blog</name>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[[Hμblog] Libreboot 10-year anniversary]]></title>
        <id>https://www.devever.net/~hl/u/202312#13a</id>
        <link href="https://www.devever.net/~hl/u/202312#13a"/>
        <updated>2023-12-13T08:11:05.000Z</updated>
        <summary type="html"><![CDATA[<div type="xhtml"><div xmlns="http://www.w3.org/1999/xhtml"><ul><li><a href="https://libreboot.org/news/10.html">Libreboot 10-year anniversary</a></li></ul><p xmlns="http://www.w3.org/1999/xhtml">Leah Rowe has written an interesting article about the history of the Libreboot project on the project's 10th anniversary. Recommended reading if you're interested in the open source firmware ecosystem.</p></div></div>]]></summary>
        <author>
            <name>devever.net/~hl</name>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Measuring the size of the cache line empirically]]></title>
        <id>https://lemire.me/blog/?p=21030</id>
        <link href="https://lemire.me/blog/2023/12/12/measuring-the-size-of-the-cache-line-empirically/"/>
        <updated>2023-12-12T18:17:36.000Z</updated>
        <summary type="html"><![CDATA[Our computers do not read or write memory in units of bits or even bytes. Rather memory is accessed in small blocks of memory called “cache lines”. For a given system, the cache line size is usually fixed and small (e.g.,  16 to 256 bytes). All Intel/AMD x64 systems I have used relied on a … Continue reading Measuring the size of the cache line empirically]]></summary>
        <author>
            <name>Daniel Lemire</name>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Non-Send Futures When?]]></title>
        <id>https://matklad.github.io/2023/12/10/nsfw.html</id>
        <link href="https://matklad.github.io/2023/12/10/nsfw.html"/>
        <updated>2023-12-10T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Ever since reading
What If We Pretended That a Task = Thread?
I can't stop thinking about borrowing non-Sync data across .await.
In this post, I'd love to take one more look at the problem.]]></summary>
        <author>
            <name>matklad</name>
        </author>
    </entry>
</feed>